CREATE EXTERNAL TABLE '${DIR_DATATGT}/${EXRT_FILE_NM}.pipe'
USING (DELIMITER ${NZ_DATA_DELIM} DATEDELIM '/' DATESTYLE 'MDY' timestyle '12HOUR'  REMOTESOURCE 'odbc' NULLVALUE '' ESCAPECHAR '\')  AS
SELECT MONTH_NAME,
        ORG_KEY,
        RGU_LOB,
        PREMISE_KEY,
        CUSTOMER_ACCT_KEY,
        CUSTOMER_NAME,
        ACCOUNT_NUMBER,
        CUSTOMER_ADDRESS_LINE_1,
        CUSTOMER_ADDRESS_LINE_2,
        CUSTOMER_ADDRESS_LINE_3,
        CUSTOMER_ADDRESS_LINE_4,
        CUSTOMER_ZIP_CODE,
        CUSTOMER_CITY_NAME,
        CUSTOMER_STATE,
        PROPERTY_NAME,
        PROPERTY_ADDRESS_LINE_1,
        PROPERTY_ADDRESS_LINE_2,
        PROPERTY_ADDRESS_LINE_3,
        PROPERTY_ADDRESS_LINE_4,
        PROPERTY_ZIP_CODE,
        PROPERTY_CITY_NAME,
        PROPERTY_STATE,
        CUSTOMER_SEGMENT,
        BUNDLE_TYPE,
        PRODUCT_CLASS_TEXT,
        CUSTOMER_CLASS_TEXT,
        SERVICE_NAME,
        PROJECTED_REVENUE,
        ASSOCIATION_CODE,
        DEVELOPMENT_KEY,
        DEV_MISC_CODE,
        HOUSE_CODE,
        DISCONNECT_REASON,
        CONNECT_DISCONNECT_TYPE
FROM (
SELECT MO_NM AS MONTH_NAME,
        CAST(ORG_KEY AS VARCHAR(15)) ORG_KEY,
		RGU_LOB AS RGU_LOB,
        CAST(HS_NBR AS VARCHAR(30)) PREMISE_KEY,
        CAST(CUST_ACCT_KEY AS VARCHAR(15)) CUSTOMER_ACCT_KEY,
        CUST_NM AS CUSTOMER_NAME,
        ACCT_NBR AS ACCOUNT_NUMBER,
        CUST_ADDR_LINE_1 AS CUSTOMER_ADDRESS_LINE_1,
        CUST_ADDR_LINE_2 AS CUSTOMER_ADDRESS_LINE_2,
        CUST_ADDR_LINE_3 AS CUSTOMER_ADDRESS_LINE_3,
        CUST_ADDR_LINE_4 AS CUSTOMER_ADDRESS_LINE_4,
        CUST_ZIP AS CUSTOMER_ZIP_CODE,
        CUST_CITY_NM AS CUSTOMER_CITY_NAME,
        CUST_ST AS CUSTOMER_STATE,
        PRPTY_NM AS PROPERTY_NAME,
        PRPTY_ADDR_LINE_1 AS PROPERTY_ADDRESS_LINE_1,
        PRPTY_ADDR_LINE_2 AS PROPERTY_ADDRESS_LINE_2,
        PRPTY_ADDR_LINE_3 AS PROPERTY_ADDRESS_LINE_3,
        PRPTY_ADDR_LINE_4 AS PROPERTY_ADDRESS_LINE_4,
        PRPTY_ZIP AS PROPERTY_ZIP_CODE,
        PRPTY_CITY_NM AS PROPERTY_CITY_NAME,
        PRPTY_ST AS PROPERTY_STATE,
        CUST_SEG_NM AS CUSTOMER_SEGMENT,
        BNDL_TYP AS BUNDLE_TYPE,
        PROD_CLS_TXT AS PRODUCT_CLASS_TEXT,
        CUST_CLS_TXT AS CUSTOMER_CLASS_TEXT,
        SRVC_NM AS SERVICE_NAME,
        CAST(ROUND(PRJ_RVNU_AMT,2) AS VARCHAR(40)) PROJECTED_REVENUE,
        ASSN_CD AS ASSOCIATION_CODE,
        CAST(DVLPMNT_KEY AS VARCHAR(15)) DEVELOPMENT_KEY,
        DVLPMNT_MISC_CD AS DEV_MISC_CODE,
        HS_CD AS HOUSE_CODE,
        DISCNCT_RSN_DESC AS DISCONNECT_REASON,
        CNCT_DISCNCT_TYP AS CONNECT_DISCONNECT_TYPE
FROM ${NZ_DATABASE_EXRT}..MDU_PREMISE_EXTRACT
WHERE MO_NM = '${MNTH_NM}'
UNION ALL
(SELECT 'MONTH_NAME' MONTH_NAME,
        'ORG_KEY' ORG_KEY,
		'RGU_LOB' RGU_LOB,
        'PREMISE_KEY' PREMISE_KEY,
        'CUSTOMER_ACCT_KEY' CUSTOMER_ACCT_KEY,
        'CUSTOMER_NAME' CUSTOMER_NAME,
        'ACCOUNT_NUMBER' ACCOUNT_NUMBER,
        'CUSTOMER_ADDRESS_LINE_1' CUSTOMER_ADDRESS_LINE_1,
        'CUSTOMER_ADDRESS_LINE_2' CUSTOMER_ADDRESS_LINE_2,
        'CUSTOMER_ADDRESS_LINE_3' CUSTOMER_ADDRESS_LINE_3,
        'CUSTOMER_ADDRESS_LINE_4' CUSTOMER_ADDRESS_LINE_4,
        'CUSTOMER_ZIP_CODE' CUSTOMER_ZIP_CODE,
        'CUSTOMER_CITY_NAME' CUSTOMER_CITY_NAME,
        'CUSTOMER_STATE' CUSTOMER_STATE,
        'PROPERTY_NAME' PROPERTY_NAME,
        'PROPERTY_ADDRESS_LINE_1' PROPERTY_ADDRESS_LINE_1,
        'PROPERTY_ADDRESS_LINE_2' PROPERTY_ADDRESS_LINE_2,
        'PROPERTY_ADDRESS_LINE_3' PROPERTY_ADDRESS_LINE_3,
        'PROPERTY_ADDRESS_LINE_4' PROPERTY_ADDRESS_LINE_4,
        'PROPERTY_ZIP_CODE' PROPERTY_ZIP_CODE,
        'PROPERTY_CITY_NAME' PROPERTY_CITY_NAME,
        'PROPERTY_STATE' PROPERTY_STATE,
        'CUSTOMER_SEGMENT' CUSTOMER_SEGMENT,
        'BUNDLE_TYPE' BUNDLE_TYPE,
        'PRODUCT_CLASS_TEXT' PRODUCT_CLASS_TEXT,
        'CUSTOMER_CLASS_TEXT' CUSTOMER_CLASS_TEXT,
        'SERVICE_NAME' SERVICE_NAME,
        'PROJECTED_REVENUE' PROJECTED_REVENUE,
        'ASSOCIATION_CODE' ASSOCIATION_CODE,
        'DEVELOPMENT_KEY' DEVELOPMENT_KEY,
        'DEV_MISC_CODE' DEV_MISC_CODE,
        'HOUSE_CODE' HOUSE_CODE,
        'DISCONNECT_REASON' DISCONNECT_REASON,
        'CONNECT_DISCONNECT_TYPE' CONNECT_DISCONNECT_TYPE
FROM ${NZ_DATABASE_EXRT}..MDU_PREMISE_EXTRACT
WHERE PRMS_KEY IS NOT NULL
	AND MO_NM = '${MNTH_NM}'
LIMIT 1)
) A
ORDER BY PREMISE_KEY DESC;
